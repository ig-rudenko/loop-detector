## Loop Detector

Схема работы

![schema](/docs/schema.jpg)

## Настройка

1. Для работы приложения необходимо иметь настроенные приложение
   [Ecstasy](https://github.com/ig-rudenko/ecstasy) и Elasticsearch.

2. Для приложения `GraphGen` нужно создать файл `.env` в папке `graph_gen/env`
   с переменными окружения.
   Пример файла со значениями по умолчанию находится в
   `graph_gen/env/sample.env`. На основе этого файла нужно создать свой.
   Можно его разместить в другом месте, но тогда придется указать его в `docker-compose.yaml` файле.

3. То же самое нужно проделать и для `web_app`. Пример файла переменных окружения
   находится в `web_app/env/sample.env`.

## Запуск

Приложение запускается с помощью `docker compose`.

Для начала необходимо создать (либо указать свои) файлы сертификатов для `nginx`.

По умолчанию указаны следующие пути для поиска:

- Приватный ключ `/etc/ssl/private/selfsigned.key`
- Сертификат `/etc/ssl/certs/selfsigned.crt`
- Ключи Диффи-Хеллмана `/etc/ssl/certs/dhparam.pem`

Перед запуском нужно создать файл в корне проекта (можно пустой) для хранения настроек
оповещений о новых петлях. По умолчанию в docker-compose.yaml его название
указано как `notifications.json`. Там будут создаваться способы оповещений.

Далее нужно запустить проект через `docker compose`.

Приложение будет сохранять граф петель и его сообщения в json файлы.
Хранилище по умолчанию указано как `./loop_storage`.